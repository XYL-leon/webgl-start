<script setup>
import { onMounted, ref } from "vue";

const aaa = [
  "rgba(226,253,248,255)",
  "rgba(226,253,248,255)",
  "rgba(201,249,234,255)",
  "rgba(178,242,112,255)",
  "rgba(149,223,99,255)",
  "rgba(149,223,99,255)",
  "rgba(130,201,86,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(118,186,73,255)",
  "rgba(243,238,123,255)",
  "rgba(243,238,123,255)",
  "rgba(243,238,123,255)",
  "rgba(243,238,123,255)",
  "rgba(243,238,123,255)",
  "rgba(243,238,123,255)",
  "rgba(235,219,95,255)",
  "rgba(235,219,95,255)",
  "rgba(235,219,95,255)",
  "rgba(235,219,95,255)",
  "rgba(235,219,95,255)",
  "rgba(235,219,95,255)",
  "rgba(233,186,87,255)",
  "rgba(233,186,87,255)",
  "rgba(233,186,87,255)",
  "rgba(233,186,87,255)",
  "rgba(233,186,87,255)",
  "rgba(233,186,87,255)",
  "rgba(225,128,79,255)",
  "rgba(225,128,79,255)",
  "rgba(225,128,79,255)",
  "rgba(225,128,79,255)",
  "rgba(225,128,79,255)",
  "rgba(225,128,79,255)",
  "rgba(214,93,64,255)",
  "rgba(214,93,64,255)",
  "rgba(214,93,64,255)",
  "rgba(214,93,64,255)",
  "rgba(214,93,64,255)",
  "rgba(214,93,64,255)",
  "rgba(214,93,64,255)",
  "rgba(194,62,51,255)",
  "rgba(194,62,51,255)",
  "rgba(194,62,51,255)",
  "rgba(194,62,51,255)",
  "rgba(194,62,51,255)",
  "rgba(172,48,33,255)",
  "rgba(172,48,33,255)",
  "rgba(172,48,33,255)",
  "rgba(172,48,33,255)",
  "rgba(172,48,33,255)",
  "rgba(172,48,33,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
  "rgba(158,42,43,255)",
];

const PreLegend6min = {
  unit: "mm",
  colors: [
    [0.016, "rgb(226, 253, 248)"], // 0.1
    [0.046, "rgb(201, 249, 234)"],
    [0.076, "rgb(178, 242, 112)"],
    [0.1, "rgb(149, 223, 99)"],
    [0.13, "rgb(130, 201, 86)"],
    [0.16, "rgb(118, 186, 73)"], // 1 // 小雨
    [0.83, "rgb(243, 238, 123)"], // 中雨 5
    [0.95, "rgb(235, 219, 95)"],
    [1.07, "rgb(233, 186, 87)"],
    [1.19, "rgb(225, 128, 79)"],
    [1.3, "rgb(214, 93, 64)"],
    [1.43, "rgb(194, 62, 51)"],
    [1.54, "rgb(172, 48, 33)"],
    [1.66, "rgb(158, 42, 43)"], // 大雨 10
    // [3.333, "rgb(158, 42, 43)"], // 暴雨 20 // 暂不显示暴雨、特大暴雨
    [5.0, "rgb(158, 42, 43)"], // 设限5mm
    // [6.667, "rgb(158, 42, 43)"], // 特大暴雨 400

    // 气象实况
    // [0.3,"rgb(110, 219, 104)"],
    // [0.45,"rgb(88, 200, 85)"],
    // [0.6,"rgb(65, 182, 67)"],
    // [0.75,"rgb(57, 207, 57)"],
    // [0.9,"rgb(50, 132, 47)"],
    // [1.6,"rgb(78, 151, 148)"],
    // [2.7,"rgb(106, 181, 246)"],
    // [3.75,"rgb(58, 92, 250)"],
    // [4.8,"rgb(2, 3, 254)"],
    // [8.1,"rgb(121, 5, 250)"],
    // [11.4,"rgb(240, 7, 246)"],

    // 雷达
    // [0, "rgba(0,0,0,0)"],
    // [5, "rgb(46, 170, 240)"],
    // [10, "rgb(44, 238, 238)"],
    // [15, "rgb(43, 255, 44)"],
    // [20, "rgb(44, 208, 42)"],
    // [25, "rgb(45, 159, 45)"],
    // [30, "rgb(252, 255, 42)"],
    // [35, "rgb(241, 201, 44)"],
    // [40, "rgb(255, 161, 46)"],
    // [45, "rgb(253, 44, 40)"],
    // [50, "rgb(221, 41, 44)"],
    // [55, "rgb(204, 41, 38)"],
    // [60, "rgb(253, 40, 239)"],
    // [65, "rgb(140, 41, 151)"],
    // [70, "rgb(187, 161, 250)"],
  ],
};

let container = ref(null);
let ctx = null;

function makeCilirRamp(colors) {
  const minRampVal = colors[0][0];
  const maxRampVal = colors[colors.length - 1][0];
  const valueRange = maxRampVal - minRampVal;

  //   // WebGL 中绑定颜色纹理的最大和最小值
  //   const gl = this.gl;
  //   const program = this.program;
  //   gl.uniform1f(program.ramp_min, minRampVal);
  //   gl.uniform1f(program.ramp_max, maxRampVal);

  //   const canvas = document.createElement("canvas");
  //   const ctx = canvas.getContext("2d");
  //   canvas.width = 256;
  //   canvas.height = 1;

  // 计算每个颜色应该占据的像素宽度
  // 先将颜色值转换为归一化位置
  const colorPositions = colors.map((color) => (color[0] - minRampVal) / valueRange);

  // 绘制非渐变的颜色块
  for (let i = 0; i < colors.length - 1; i++) {
    // 计算当前颜色块的起始和结束像素位置
    const startX = Math.round(colorPositions[i] * 256);
    const endX = Math.round(colorPositions[i + 1] * 256);
    const width = endX - startX;

    // 使用当前颜色填充整个区间
    ctx.fillStyle = colors[i][1];
    ctx.fillRect(startX, 0, width, 1);
  }

  // 处理最后一个颜色块（确保覆盖到256像素位置）
  const lastIndex = colors.length - 1;
  const lastStartX = Math.round(colorPositions[lastIndex - 1] * 256);
  ctx.fillStyle = colors[lastIndex][1];
  ctx.fillRect(lastStartX, 0, 256 - lastStartX, 1);
  console.log(lastIndex);
  console.log(ctx.getImageData(0, 0, 256, 1).data);
  console.log(new Uint8Array(ctx.getImageData(0, 0, 256, 1).data));
  //   return new Uint8Array(ctx.getImageData(0, 0, 256, 1).data);

  let arr = new Uint8Array(ctx.getImageData(0, 0, 256, 1).data);
  let test = [];
  arr.map((item, index) => {
    if ((index + 1) % 4 === 0) {
      //   arr[index] = 255;
      test.push(`rgba(${arr[index - 3]},${arr[index - 2]},${arr[index - 1]},255)`);
    }
  });
  console.log(JSON.stringify(test));
}

onMounted(() => {
  ctx = container.value.getContext("2d");

  makeCilirRamp(PreLegend6min.colors);
});
</script>
<template>
  <canvas
    id="tutorial"
    ref="container"
    width="300"
    height="300"
    class="color-container"
  ></canvas>
</template>
<style lang="scss" scoped>
#tutorial {
  border: 1px solid #ccc;
  background: #000;
  width: 256px;
  height: 1px;
}
</style>
